version: '3.0'

networks:
        br-xray:
                external: false

services:
        nginx:
                container_name: xray_nginx
                image: linuxserver/swag
                restart: unless-stopped
                cap_add:
                        - NET_ADMIN
                networks:
                        - br-xray
                environment:
                        - PUID={{ uid }}
                        - PGID={{ gid }}
                        - TZ=US/Eastern
                        - URL={{ domain }}
                        - SUBDOMAINS={{ subdomain }}
                        - VALIDATION=http
                        - EMAIL=dummy@dummy.com
                        - DHLEVEL=2048
                        - ONLY_SUBDOMAINS={{ subdomain_only }}
                        - STAGING=false
                ports:
                        - 80:80
                volumes:
                        - ./certs:/etc/letsencrypt/live/{{ domain }}
        v2ray:
                container_name: xray_xray
                image: teddysun/xray
                restart: unless-stopped
                networks:
                        - br-v2ray
                ports:
                        - 443:443
                volumes:
                        - ./xray/config.json:/etc/xray/config.json
                        - ./certs:/certs

{{ watchtower }}
